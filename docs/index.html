<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>nil@techno-lab — minimal but brutal (v6)</title>
  <meta name="description" content="minimal but brutal — rotating track lists + floating player + transmissions mock + artwork thumbnails." />
  <style>
    
    

:root{
      --bg:#07070b;
      --panel:rgba(14,8,20,.72);
      --text:rgba(245,245,255,.92);
      --muted:rgba(245,245,255,.62);
      --line:rgba(245,245,255,.18);
      --accent:rgba(220,80,255,.95);
      --accent2:rgba(60,255,170,.9);
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --radius:14px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }
    *{box-sizing:border-box} html,body{position:relative;height:100%}
body{background-size:cover !important;background-position:center !important;background-attachment:fixed !important;background-repeat:no-repeat !important;}

    body{
      margin:0;
      font-family:var(--mono);
  background-image:
    radial-gradient(1200px 900px at 70% 15%, rgba(220,80,255,0.20), transparent 60%),
    radial-gradient(900px 700px at 20% 70%, rgba(60,255,170,0.12), transparent 65%);

        var(--bg);
      color:var(--text);
      letter-spacing:.2px;
    }
    a{color:inherit;text-decoration:none} a:hover{text-decoration:underline}
    .statusbar{
      position:sticky;top:0;z-index:20;
      backdrop-filter:blur(10px);
      background:rgba(7,7,11,.72);
      border-bottom:1px solid var(--line);
    }
    .statusbar .inner{
      max-width:1020px;margin:0 auto;padding:12px 18px;
      display:flex;align-items:center;justify-content:space-between;gap:16px;
    }
    .status-left{display:flex;gap:12px;align-items:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .status-right{display:flex;gap:10px;align-items:center;font-size:12px;color:var(--muted);white-space:nowrap}
    .pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}
    .pill strong{color:var(--text);font-weight:700}
    .bpm{border:1px solid rgba(220,80,255,.38);border-radius:10px;padding:6px 10px;box-shadow:0 0 0 1px rgba(220,80,255,.12) inset}
    .wrap{max-width:1020px;margin:0 auto;padding:28px 18px 96px}
    .panel{background:var(--panel);border:1px solid rgba(220,80,255,.26);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .boot{display:grid;gap:10px}
    .boot .line{color:var(--muted);font-size:13px;line-height:1.45}
    .boot .line b{color:var(--text);font-weight:700}
    .divider{margin:22px 0 14px;border-top:1px solid var(--line);opacity:.9}
    pre{margin:0;white-space:pre;overflow-x:auto;color:rgba(245,245,255,.88)}
    .ascii-sigil{
      margin-top:18px;padding:18px;
      border:1px solid rgba(220,80,255,.28);
      border-radius:var(--radius);
      background:rgba(10,6,16,.62);
      box-shadow:0 0 0 1px rgba(220,80,255,.12) inset;
    }
    .identity{margin-top:16px;display:flex;flex-wrap:wrap;align-items:baseline;justify-content:space-between;gap:12px}
    .identity .name{font-size:14px;color:var(--muted)}
    .identity .name strong{color:var(--text);font-size:14px}
    .identity .links{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;color:var(--muted)}
    .identity .links a{padding:6px 10px;border:1px solid var(--line);border-radius:999px}
    .identity .links a:hover{border-color:rgba(220,80,255,.45);box-shadow:0 0 0 1px rgba(220,80,255,.12) inset;text-decoration:none}
    .nav{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .nav button{
      font-family:var(--mono);
      border:1px solid rgba(245,245,255,.18);
      background:transparent;
      color:var(--muted);
      padding:10px 12px;border-radius:999px;
      cursor:pointer;font-size:12px;letter-spacing:.3px;
      transition:border-color 160ms ease,color 160ms ease,background 160ms ease;
    }
    .nav button[aria-selected="true"]{
      border-color:rgba(220,80,255,.62);
      color:var(--text);
      background:rgba(220,80,255,.08);
      box-shadow:0 0 0 1px rgba(220,80,255,.10) inset;
    }
    .nav button:hover{border-color:rgba(220,80,255,.45);color:rgba(245,245,255,.82)}
    .section{margin-top:16px;display:none;gap:14px}
    .section.active{display:grid}
    .section h2{margin:0;font-size:12px;letter-spacing:.9px;color:var(--muted);text-transform:uppercase}
    .track-frame{padding:14px;border-radius:12px;border:1px solid rgba(245,245,255,.16);background:rgba(7,7,11,.38)}
    .track-head{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:10px}
    .track-title{color:var(--text);font-size:13px}
    .track-meta{color:var(--muted);font-size:12px;white-space:nowrap}
    .note{color:var(--muted);font-size:12px;line-height:1.5}
    .terminal{
      margin-top:2px;padding:16px;
      border:1px solid rgba(245,245,255,.16);
      border-radius:var(--radius);
      background:rgba(7,7,11,.42);
      color:rgba(245,245,255,.82);
      font-size:13px
    }
    .terminal .muted{color:var(--muted)}
    .prompt{color:rgba(60,255,170,.88)}
    .caret{display:inline-block;width:10px;height:16px;background:rgba(245,245,255,.78);margin-left:4px;vertical-align:-3px;animation:blink 1.1s steps(1,end) infinite;border-radius:2px}
    @keyframes blink{50%{opacity:0}}

    .btn{
      font-family:var(--mono);
      font-size:11px;padding:8px 10px;border-radius:999px;
      border:1px solid rgba(245,245,255,.18);
      background:transparent;color:var(--muted);cursor:pointer
    }
    .btn:hover{border-color:rgba(220,80,255,.45);color:rgba(245,245,255,.86)}
    .btn.primary{
      border-color:rgba(220,80,255,.55);
      color:rgba(245,245,255,.88);
      background:rgba(220,80,255,.08);
      box-shadow:0 0 0 1px rgba(220,80,255,.10) inset
    }
    .btn.primary:hover{border-color:rgba(220,80,255,.75)}
    .btn.green{
      border-color:rgba(60,255,170,.42);
      color:rgba(245,245,255,.88);
      background:rgba(60,255,170,.06);
      box-shadow:0 0 0 1px rgba(60,255,170,.10) inset
    }
    .btn.green:hover{border-color:rgba(60,255,170,.62)}
    .btnrow{display:flex;gap:8px;flex-wrap:wrap}

    .rotator{
      display:grid;gap:10px;
      padding:12px;border-radius:12px;
      border:1px solid rgba(245,245,255,.14);
      background:rgba(0,0,0,.14);
    }
    .rotator .now{
      display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap
    }
    .now-left{display:flex;align-items:center;gap:10px;min-width:0}
    .thumb{
      width:44px;height:44px;border-radius:10px;flex:0 0 auto;
      border:1px solid rgba(245,245,255,.14);
      background:linear-gradient(135deg, rgba(220,80,255,.18), rgba(60,255,170,.10));
      overflow:hidden;
      box-shadow:0 0 0 1px rgba(220,80,255,.10) inset;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .rotator .now .t{font-size:13px;color:rgba(245,245,255,.90);min-width:0}
    .rotator .now .t b{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:520px}
    .rotator .now .m{font-size:12px;color:var(--muted)}
    .rotator .mini{font-size:12px;color:var(--muted);line-height:1.45}

    .index{display:grid;gap:10px}
    .index-row{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 12px;border:1px solid rgba(245,245,255,.14);
      border-radius:12px;background:rgba(0,0,0,.16)
    }
    .index-left{display:flex;align-items:center;gap:10px;min-width:0}
    .tag{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(220,80,255,.28);color:rgba(245,245,255,.82);white-space:nowrap}
    .tag.green{border-color:rgba(60,255,170,.35)}
    .tag.dim{border-color:rgba(245,245,255,.14);color:rgba(245,245,255,.68)}
    .index-left a{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;max-width:420px;color:rgba(245,245,255,.9)}
    .index-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}

    .tx-list{display:grid;gap:10px}
    .tx-item{padding:12px;border:1px solid rgba(245,245,255,.14);border-radius:12px;background:rgba(0,0,0,.14)}
    .tx-top{display:flex;justify-content:space-between;gap:10px;align-items:baseline;margin-bottom:8px}
    .tx-time{color:var(--muted);font-size:11px;white-space:nowrap}
    .tx-badge{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(60,255,170,.32);color:rgba(245,245,255,.86);white-space:nowrap}
    .tx-text{font-size:12.5px;line-height:1.55;color:rgba(245,245,255,.86)}
    .tx-tags{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .tx-tags a{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(220,80,255,.22);color:rgba(245,245,255,.76)}
    .tx-tags a:hover{border-color:rgba(220,80,255,.45);text-decoration:none}

    /* Floating player */
    .player{
      position:fixed;right:16px;bottom:16px;z-index:50;
      width:min(420px, calc(100vw - 32px));
      background:rgba(10,6,16,.82);
      border:1px solid rgba(220,80,255,.32);
      border-radius:16px;
      box-shadow:0 22px 80px rgba(0,0,0,.62);
      backdrop-filter:blur(10px);
      overflow:hidden;
    }
    .player.hidden{display:none}
    .player-head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border-bottom:1px solid rgba(245,245,255,.14)
    }
    .player-title{min-width:0}
    .player-title .small{font-size:11px;color:var(--muted)}
    .player-title .big{font-size:12px;color:rgba(245,245,255,.92);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:260px}
    .player-controls{display:flex;gap:8px;align-items:center}
    iframe{width:100%;border:0;background:transparent}
    .player iframe{height:166px}
    .player-foot{
      padding:10px 12px;border-top:1px solid rgba(245,245,255,.12);
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap
    }
    .player-foot .hint{font-size:11px;color:var(--muted)}
    @media (max-width:700px){
      .status-right{display:none}
      .index-left a{max-width:180px}
      .tx-top{flex-direction:column;align-items:flex-start}
      .player-title .big{max-width:180px}
      .rotator .now .t b{max-width:240px}
    }
  </style>
</head>
<body>
  <div class="statusbar"><div class="inner">
    <div class="status-left">
      <span class="pill"><strong>nil@techno-lab</strong> · berlin underground</span>
      <span class="pill">status: <strong>TRANSMITTING</strong></span>
    </div>
    <div class="status-right">
      <span class="bpm"><strong id="bpmValue">140</strong> BPM</span>
      <span class="pill">bass: <strong>CRITICAL</strong></span>
      <span class="pill">signal: <strong>STABLE</strong></span>
    </div>
  </div></div>

  <main class="wrap">
    <section class="panel">
      <div class="boot">
        <div class="line">┌─[dj@underground-lab]─[~/techno_transmission]</div>
        <div class="line">└──╼ $ play ./beats --frequency=<b id="freqValue">140bpm</b> --location=<b>berlin</b></div>
        <div class="divider"></div>
        <div class="line">[INFO] techno lab initialized</div>
        <div class="line">[INFO] underground frequencies loaded</div>
        <div class="line">[INFO] bass enhancement: <b>ACTIVE</b></div>
        <div class="line">[INFO] 140 bpm synchronization: <b>OPTIMAL</b></div>
        <div class="line">[INFO] berlin connection: <b>ESTABLISHED</b></div>
        <div class="line">[INFO] audio-visual necromancy: <b>ONLINE</b></div>
      </div>

      <div class="ascii-sigil"><pre>███╗   ██╗██╗██╗     
████╗  ██║██║██║     
██╔██╗ ██║██║██║     
██║╚██╗██║██║██║     
██║ ╚████║██║███████╗
╚═╝  ╚═══╝╚═╝╚══════╝

           techno lab • berlin underground</pre></div>

      <div class="identity">
        <div class="name"><strong>nil</strong> — audio-visual necromancer · terminal ritualist
          <div style="margin-top:6px;color:var(--muted);font-size:12px;">
            soundcloud main: <a href="https://soundcloud.com/user-926749805" target="_blank" rel="noopener">soundcloud.com/user-926749805</a>
          </div>
        </div>
        <div class="links">
          <a href="https://soundcloud.com/user-926749805" target="_blank" rel="noopener">SoundCloud</a>
          <a href="https://soundcloud.com/user-926749805/popular-tracks" target="_blank" rel="noopener">Popular Tracks</a>
          <a href="mailto:music@n-il.de">Mail</a>
        </div>
      </div>

      <div class="nav" role="tablist">
        <button role="tab" aria-selected="true" data-tab="sound">[ SOUND ]</button>
        <button role="tab" aria-selected="false" data-tab="transmissions">[ TRANSMISSIONS ]</button>
        <button role="tab" aria-selected="false" data-tab="contact">[ CONTACT ]</button>
      </div>

      <div id="sound" class="section active" role="tabpanel">
        <h2>Sound</h2>

        <div class="track-frame">
          <div class="track-head">
            <div class="track-title">SPOTLIGHT (rotating)</div>
            <div class="track-meta">every <span id="spotlightEvery">30s</span></div>
          </div>

          <div class="rotator" id="spotlightBox">
            <div class="now">
              <div class="now-left">
                <div class="thumb"><img id="spotlightImg" alt="" /></div>
                <div class="t"><b id="spotlightTitle">…</b></div>
              </div>
              <div class="m">plays in floating player</div>
            </div>
            <div class="mini">Rotates the visible title/artwork only. Playback is isolated, so your listener never gets interrupted.</div>
            <div class="btnrow">
              <button class="btn green" id="spotlightPlay">play</button>
              <button class="btn" id="spotlightOpen">open</button>
              <button class="btn primary" id="spotlightNext">next</button>
              <button class="btn" id="spotlightShuffle">shuffle</button>
              <button class="btn" id="spotlightPause">pause</button>
            </div>
          </div>
        </div>

        <div class="track-frame">
          <div class="track-head">
            <div class="track-title">MOST PLAYED (rotating)</div>
            <div class="track-meta">every <span id="popularEvery">45s</span></div>
          </div>

          <div class="rotator" id="popularBox">
            <div class="now">
              <div class="now-left">
                <div class="thumb"><img id="popularImg" alt="" /></div>
                <div class="t"><b id="popularTitle">…</b></div>
              </div>
              <div class="m">source: popular-tracks</div>
            </div>
            <div class="mini">Same rules: rotate the “window” but keep the actual player stable.</div>
            <div class="btnrow">
              <button class="btn green" id="popularPlay">play</button>
              <button class="btn" id="popularOpen">open</button>
              <button class="btn primary" id="popularNext">next</button>
              <button class="btn" id="popularShuffle">shuffle</button>
              <button class="btn" id="popularPause">pause</button>
              <a class="btn" href="https://soundcloud.com/user-926749805/popular-tracks" target="_blank" rel="noopener">open list</a>
            </div>
          </div>

          <div class="note" style="margin-top:10px;">
            Artwork is loaded via SoundCloud oEmbed on deploy. Local file previews may show placeholders depending on browser.
          </div>
        </div>

        <div class="track-frame">
          <div class="track-head">
            <div class="track-title">TRACK INDEX</div>
            <div class="track-meta">with artwork</div>
          </div>
          <div class="index" id="trackIndex"></div>
          <div class="note" style="margin-top:10px;">
            Performance rule: only <b>one</b> SoundCloud iframe exists (the floating player). Everything else is lightweight + images.
          </div>
        </div>
      </div>

      <div id="transmissions" class="section" role="tabpanel">
        <h2>Transmissions</h2>
        <div class="track-frame">
          <div class="track-head">
            <div class="track-title">TRANSMISSION LOG (tweet demo)</div>
            <div class="track-meta">IFTTT → transmissions.json</div>
          </div>

          <div class="note">
            Demo is hardcoded. If you later drop a <b>transmissions.json</b> next to this HTML, it will auto-load it and replace the demo.
          </div>

          <div class="terminal" style="margin-top:12px;">
            <div><span class="prompt">└──╼ $</span> listen --source x --tags-only --hashtag <span class="muted">#technolab</span> --hashtag <span class="muted">#techno</span> --hashtag <span class="muted">#nil</span></div>
            <div class="muted">[INFO] IFTTT can push matching posts into transmissions.json</div>
          </div>

          <div class="divider"></div>
          <div class="tx-list" id="txList"></div>
        </div>
      </div>

      <div id="contact" class="section" role="tabpanel">
        <h2>Contact</h2>
        <div class="track-frame">
          <div class="track-head"><div class="track-title">music bookings</div><div class="track-meta">clean channel</div></div>
          <div class="note"><a href="mailto:music@n-il.de">music@n-il.de</a><br/>berlin</div>
        </div>
        <div class="terminal">
          <div><span class="prompt">└──╼ $</span> echo "keep the bass heavy and the code clean"</div>
          <div class="muted">[INFO] ready for interdimensional transmission</div>
          <div><span class="prompt">└──╼ $</span> <span class="caret" aria-hidden="true"></span></div>
        </div>
      </div>

      <div class="divider"></div>
      <div class="note">
        Playback rule: rotations never touch the player. Only explicit user action changes the player track.
      </div>
    </section>
  </main>

  <!-- Floating Player -->
  <aside class="player hidden" id="player">
    <div class="player-head">
      <div class="player-title">
        <div class="small">floating player</div>
        <div class="big" id="playerTitle">nothing loaded</div>
      </div>
      <div class="player-controls">
        <button class="btn" id="playerMin">hide</button>
        <button class="btn primary" id="playerOpen">open</button>
        <button class="btn" id="playerClose">x</button>
      </div>
    </div>
    <iframe id="playerEmbed" scrolling="no" allow="autoplay"></iframe>
    <div class="player-foot">
      <div class="hint">tip: keep browsing while it plays</div>
    </div>
  </aside>

<script>
  const BPM = 140;
  const SPOTLIGHT_ROTATION_INTERVAL_MS = 30000;
  const POPULAR_ROTATION_INTERVAL_MS = 45000;

  const SPOTLIGHT = [
    { title: "ändägäländä", url: "https://soundcloud.com/user-926749805/andagalanda" },
    { title: "chaos realm", url: "https://soundcloud.com/user-926749805/chaos-realm" },
    { title: "Upside Down (Original Mix)", url: "https://soundcloud.com/user-926749805/upside-down" },
    { title: "ENDGAMER-LVL-6", url: "https://soundcloud.com/user-926749805/endgamer-lvl-6" },
    { title: "Mothership", url: "https://soundcloud.com/user-926749805/mothership" }
  ];

  const POPULAR = [
    { title: "Upside Down (Original Mix)", url: "https://soundcloud.com/user-926749805/upside-down" },
    { title: "ENDGAMER-LVL-6", url: "https://soundcloud.com/user-926749805/endgamer-lvl-6" },
    { title: "COPENHAGEN (Nightmares)-(mastered).mp3", url: "https://soundcloud.com/user-926749805/nightmares-remastered-mp3" },
    { title: "ENDGAMER-LVL-8", url: "https://soundcloud.com/user-926749805/endgamer-lvl-8-1" },
    { title: "Upside Down Tech-House-Mix", url: "https://soundcloud.com/user-926749805/upside-down-techhouse" },
    { title: "ENDGAMER-LVL-7", url: "https://soundcloud.com/user-926749805/endgamer-lvl-7-2" },
    { title: "ENDGAMER-LVL-5", url: "https://soundcloud.com/user-926749805/endgamer-lvl-5-3" },
    { title: "ENDGAMER-LVL-4", url: "https://soundcloud.com/user-926749805/endgamer-lvl-4-4" }
  ];

  const INDEX = [
    { title: "ändägäländä", url: "https://soundcloud.com/user-926749805/andagalanda", tag: "PICK" },
    { title: "chaos realm", url: "https://soundcloud.com/user-926749805/chaos-realm", tag: "PICK" },
    ...POPULAR.map(t => ({...t, tag:"POPULAR"})),
    { title: "Open full popular-tracks list", url: "https://soundcloud.com/user-926749805/popular-tracks", tag: "LINK", externalOnly: true }
  ];

  const DUMMY_TRANSMISSIONS = [
    { time: "2026-01-03 00:42", source: "X", text: "SPOTLIGHT rotation online. New basement run.", url: "https://x.com/placeholder/status/10", tags: ["#technolab","#techno","#nil"] },
    { time: "2026-01-03 00:10", source: "X", text: "ändägäländä is live. Audio-reactive sickness.", url: "https://x.com/placeholder/status/11", tags: ["#technolab","#nil","#audioreactive"] },
    { time: "2026-01-02 23:31", source: "X", text: "chaos realm upload. Terminal rituals engaged.", url: "https://x.com/placeholder/status/12", tags: ["#techno","#technolab","#berlin"] },
    { time: "2026-01-02 21:07", source: "X", text: "Minimal but brutal site build shipped.", url: "https://x.com/placeholder/status/13", tags: ["#webdev","#technolab"] },
    { time: "2026-01-01 19:22", source: "X", text: "140bpm: no mercy. kick stays tight.", url: "https://x.com/placeholder/status/14", tags: ["#techno","#nil"] }
  ];

  const SC_PARAMS = {
    color:"%23dc50ff",
    auto_play:"true",
    hide_related:"true",
    show_comments:"false",
    show_user:"true",
    show_reposts:"false",
    show_teaser:"true"
  };

  // Artwork cache via SoundCloud oEmbed
  const artCache = new Map();
  async function fetchArt(url){
    if(artCache.has(url)) return artCache.get(url);
    const fallback = "";
    try{
      const oembedUrl = "https://soundcloud.com/oembed?format=json&url=" + encodeURIComponent(url);
      const res = await fetch(oembedUrl);
      if(!res.ok) throw new Error("oembed fail");
      const data = await res.json();
      const thumb = (data && data.thumbnail_url) ? data.thumbnail_url : fallback;
      artCache.set(url, thumb);
      return thumb;
    }catch(e){
      artCache.set(url, fallback);
      return fallback;
    }
  }
  function setThumb(imgEl, url){
    fetchArt(url).then(src=>{
      if(!imgEl) return;
      if(src){
        imgEl.src = src;
        imgEl.style.opacity = "1";
      }else{
        imgEl.removeAttribute("src");
        imgEl.style.opacity = "0";
      }
    });
  }

  function toSCEmbed(trackUrl){
    const u = encodeURIComponent(trackUrl);
    const qs = new URLSearchParams({ url: u, ...SC_PARAMS }).toString();
    return `https://w.soundcloud.com/player/?${qs}`;
  }
  function shuffle(arr){
    const a = arr.slice();
    for (let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  document.getElementById("bpmValue").textContent = String(BPM);
  document.getElementById("freqValue").textContent = `${BPM}bpm`;
  document.getElementById("spotlightEvery").textContent = `${Math.round(SPOTLIGHT_ROTATION_INTERVAL_MS/1000)}s`;
  document.getElementById("popularEvery").textContent = `${Math.round(POPULAR_ROTATION_INTERVAL_MS/1000)}s`;

  // Player
  const player = document.getElementById("player");
  const playerEmbed = document.getElementById("playerEmbed");
  const playerTitle = document.getElementById("playerTitle");
  const playerOpenBtn = document.getElementById("playerOpen");
  let playerUrl = null;

  function showPlayer(){ player.classList.remove("hidden"); }
  function hidePlayer(){ player.classList.add("hidden"); }

  function loadPlayer(t){
    if(!t || !t.url) return;
    playerUrl = t.url;
    playerTitle.textContent = t.title || "now playing";
    playerEmbed.src = toSCEmbed(t.url);
    showPlayer();
  }
  playerOpenBtn.addEventListener("click",()=>{ if(playerUrl) window.open(playerUrl,"_blank","noopener"); });
  document.getElementById("playerClose").addEventListener("click",()=>{
    playerUrl = null;
    playerEmbed.src = "";
    playerTitle.textContent = "nothing loaded";
    hidePlayer();
  });
  document.getElementById("playerMin").addEventListener("click",()=>hidePlayer());

  // Spotlight rotator
  let spotlightPool = SPOTLIGHT.slice();
  let spotlightIndex = 0;
  let spotlightTimer = null;
  let spotlightPaused = false;

  function renderSpotlight(){
    const t = spotlightPool[spotlightIndex];
    document.getElementById("spotlightTitle").textContent = t?.title || "…";
    document.getElementById("spotlightPlay").onclick = ()=>loadPlayer(t);
    document.getElementById("spotlightOpen").onclick = ()=>window.open(t.url,"_blank","noopener");
    setThumb(document.getElementById("spotlightImg"), t.url);
  }
  function nextSpotlight(){
    spotlightIndex = (spotlightIndex + 1) % spotlightPool.length;
    renderSpotlight();
  }
  function startSpotlightTimer(){
    if (spotlightTimer) clearInterval(spotlightTimer);
    spotlightTimer = setInterval(()=>{ if(!spotlightPaused) nextSpotlight(); }, SPOTLIGHT_ROTATION_INTERVAL_MS);
  }

  renderSpotlight();
  startSpotlightTimer();

  document.getElementById("spotlightNext").addEventListener("click",()=>nextSpotlight());
  document.getElementById("spotlightShuffle").addEventListener("click",()=>{
    spotlightPool = shuffle(spotlightPool);
    spotlightIndex = 0;
    renderSpotlight();
  });
  document.getElementById("spotlightPause").addEventListener("click",(e)=>{
    spotlightPaused = !spotlightPaused;
    e.target.textContent = spotlightPaused ? "resume" : "pause";
  });

  // Popular rotator
  let popularPool = POPULAR.slice();
  let popularIndex = 0;
  let popularTimer = null;
  let popularPaused = false;

  function renderPopular(){
    const t = popularPool[popularIndex];
    document.getElementById("popularTitle").textContent = t?.title || "…";
    document.getElementById("popularPlay").onclick = ()=>loadPlayer(t);
    document.getElementById("popularOpen").onclick = ()=>window.open(t.url,"_blank","noopener");
    setThumb(document.getElementById("popularImg"), t.url);
  }
  function nextPopular(){
    popularIndex = (popularIndex + 1) % popularPool.length;
    renderPopular();
  }
  function startPopularTimer(){
    if (popularTimer) clearInterval(popularTimer);
    popularTimer = setInterval(()=>{ if(!popularPaused) nextPopular(); }, POPULAR_ROTATION_INTERVAL_MS);
  }

  renderPopular();
  startPopularTimer();

  document.getElementById("popularNext").addEventListener("click",()=>nextPopular());
  document.getElementById("popularShuffle").addEventListener("click",()=>{
    popularPool = shuffle(popularPool);
    popularIndex = 0;
    renderPopular();
  });
  document.getElementById("popularPause").addEventListener("click",(e)=>{
    popularPaused = !popularPaused;
    e.target.textContent = popularPaused ? "resume" : "pause";
  });

  // Index with artwork
  const indexRoot = document.getElementById("trackIndex");
  function rowHTML(t, i){
    const safeTag = (t.tag||"TRACK").toUpperCase();
    const tagClass = t.externalOnly ? "tag dim" : (safeTag==="PICK" ? "tag green" : "tag");
    const thumbId = "idxThumb_" + i;
    const titleLink = `<a href="${t.url}" target="_blank" rel="noopener">${t.title}</a>`;
    const actions = t.externalOnly
      ? `<a class="btn" href="${t.url}" target="_blank" rel="noopener">open</a>`
      : `<button class="btn green" data-action="play" data-url="${t.url}" data-title="${t.title}">play</button>
         <button class="btn" data-action="open" data-url="${t.url}">open</button>`;
    return `<div class="index-row">
      <div class="index-left">
        <div class="thumb"><img id="${thumbId}" alt="" /></div>
        <span class="${tagClass}">${safeTag}</span>
        ${titleLink}
      </div>
      <div class="index-actions">${actions}</div>
    </div>`;
  }
  indexRoot.innerHTML = INDEX.map(rowHTML).join("");
  INDEX.forEach((t,i)=>{
    const el = document.getElementById("idxThumb_"+i);
    if(!t.externalOnly) setThumb(el, t.url);
    else if(el) el.style.opacity="0";
  });
  indexRoot.addEventListener("click",(e)=>{
    const btn = e.target.closest("button"); if(!btn) return;
    const action = btn.dataset.action, url = btn.dataset.url, title = btn.dataset.title;
    if(action==="open" && url) window.open(url,"_blank","noopener");
    if(action==="play" && url) loadPlayer({title,url});
  });

  // Tabs
  const tabs = Array.from(document.querySelectorAll('.nav button[role="tab"]'));
  const panels = Array.from(document.querySelectorAll('.section[role="tabpanel"]'));
  function setTab(name){
    tabs.forEach(t=>t.setAttribute("aria-selected", t.dataset.tab===name ? "true":"false"));
    panels.forEach(p=>p.classList.toggle("active", p.id===name));
  }
  tabs.forEach(t=>t.addEventListener("click",()=>setTab(t.dataset.tab)));

  // Transmissions
  function renderTx(items){
    const root = document.getElementById("txList");
    root.innerHTML = (items||[]).map(tx=>{
      const tags = (tx.tags||[]).map(tag=>`<a href="#" onclick="return false;">${tag}</a>`).join("");
      const text = (tx.text||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      return `<div class="tx-item">
        <div class="tx-top">
          <div class="tx-badge">${tx.source||"X"} · trigger</div>
          <div class="tx-time">${tx.time||""} · <a href="${tx.url||"#"}" target="_blank" rel="noopener">open</a></div>
        </div>
        <div class="tx-text">${text}</div>
        <div class="tx-tags">${tags}</div>
      </div>`;
    }).join("");
    if(!items||!items.length) root.innerHTML = `<div class="note">No transmissions yet.</div>`;
  }

  async function loadTx(){
    try{
      const res = await fetch("transmissions.json",{cache:"no-store"});
      if(!res.ok) throw new Error("no json");
      const data = await res.json();
      if(Array.isArray(data)) return renderTx(data);
      if(Array.isArray(data.items)) return renderTx(data.items);
      return renderTx(DUMMY_TRANSMISSIONS);
    }catch(e){
      renderTx(DUMMY_TRANSMISSIONS);
    }
  }
  loadTx();
</script>

<script>
/* ---- BG from /bg folder: bg-01.webp ... bg-12.webp (2-hour slots) ---- */
(function(){
  const hour = new Date().getHours();
  const idx = Math.floor(hour / 2) + 1; // 1..12
  const pad = String(idx).padStart(2, "0");
  const url = `./bg/bg-${pad}.webp`;

  // Put image UNDER the existing gradients/panels by setting body backgroundImage
  // Keep any existing background-color/gradient styles intact by overriding backgroundImage only.
  document.body.style.backgroundImage = `url("${url}")`;
  document.body.style.backgroundSize = "cover";
  document.body.style.backgroundPosition = "center";
  document.body.style.backgroundAttachment = "fixed";

  // Optional: show which bg is active if an element exists
  const pill = document.getElementById("bgpill");
  if (pill) pill.textContent = `bg: ${pad}/12`;
})();
</script>

</body>
</html>
